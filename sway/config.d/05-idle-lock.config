# Idle and Lock Screen Configuration

#########################
# Swayidle Configuration
#########################
exec swayidle -w \
    timeout 300 'swaymsg "output * dpms off"' \
        resume 'swaymsg "output * dpms on"' \
    timeout 600 'swaylock -f' \
    timeout 900 'systemctl suspend' \
    before-sleep 'swaylock -f' \
    after-resume 'swaymsg "output * dpms on"' \
    lock 'swaylock -f'

#########################
# Lock Screen
#########################
# Quick lock
bindsym $mod+l exec swaylock -f
bindsym $mod+Shift+l exec swaylock -f && systemctl suspend

# Lock configuration
exec_always {
    mkdir -p ~/.config/swaylock
    echo '
    image=$HOME/.config/sway/images/lockscreen_background.png
    font=JetBrains Mono
    font-size=24
    
    # Ring
    indicator-radius=100
    indicator-thickness=10
    
    # Colors (Catppuccin theme)
    inside-color=1e1e2e00
    inside-clear-color=1e1e2e00
    inside-ver-color=89b4fa00
    inside-wrong-color=f38ba800
    
    ring-color=b4befe
    ring-clear-color=f9e2af
    ring-ver-color=89b4fa
    ring-wrong-color=f38ba8
    
    line-color=00000000
    line-clear-color=00000000
    line-ver-color=00000000
    line-wrong-color=00000000
    
    text-color=cdd6f4
    text-clear-color=f9e2af
    text-ver-color=89b4fa
    text-wrong-color=f38ba8
    
    key-hl-color=a6e3a1
    bs-hl-color=f38ba8
    separator-color=00000000
    
    # Behavior
    show-failed-attempts
    ignore-empty-password
    indicator-idle-visible
    ' > ~/.config/swaylock/config
}

#########################
# Power Menu
#########################
set $mode_power Power: (l)ock, (s)uspend, (h)ibernate, (r)eboot, (S)hutdown, (e)xit
mode "$mode_power" {
    bindsym l exec swaylock -f; mode "default"
    bindsym s exec systemctl suspend; mode "default"
    bindsym h exec systemctl hibernate; mode "default"
    bindsym r exec systemctl reboot; mode "default"
    bindsym Shift+s exec systemctl poweroff; mode "default"
    bindsym e exec swaymsg exit; mode "default"
    
    # Return to default
    bindsym Return mode "default"
    bindsym Escape mode "default"
    bindsym $mod+Shift+e mode "default"
}
bindsym $mod+Shift+e mode "$mode_power"

#########################
# Inhibit Idle
#########################
# Inhibit idle when certain applications are fullscreen
for_window [app_id="firefox"] inhibit_idle fullscreen
for_window [app_id="mpv"] inhibit_idle visible
for_window [class="^Steam$"] inhibit_idle focus

# Manual idle inhibit toggle
bindsym $mod+Shift+i exec pkill -USR1 swayidle
